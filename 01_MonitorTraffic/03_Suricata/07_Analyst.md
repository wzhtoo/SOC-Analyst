ဒီ command ကတော့ Suricata ကို စမ်းသပ်တဲ့အခါမှာ **"အဟောင်းတွေကို ဖျက်ပြီး ကျောက်သင်ပုန်းအသစ်မှာ ပြန်စသလို"** လုပ်ပေးတဲ့ command ဖြစ်ပါတယ်။ `tmux` နဲ့ တွဲသုံးရင် အရမ်းထိရောက်ပါတယ်။

---

### ၁။ `sudo truncate -s 0 /var/log/suricata/fast.log` ဆိုတာ ဘာလဲ?

- **`truncate`**: ဖိုင်တစ်ခုရဲ့ အရွယ်အစားကို ပြောင်းလဲပေးတဲ့ command ပါ။
- **`-s 0`**: Size (အရွယ်အစား) ကို `0` လို့ သတ်မှတ်လိုက်တာပါ။ ဒါကြောင့် ဖိုင်ထဲမှာရှိသမျှ စာသား (Logs) အားလုံး ချက်ချင်း ပျက်သွားပါလိမ့်မယ်။
- **ဘာကြောင့်သုံးတာလဲ**: `fast.log` ကို ဖျက်ပစ်စရာမလိုဘဲ (Delete မလုပ်ဘဲ) ဖိုင်ထဲက စာတွေကိုပဲ အကုန်ရှင်းပစ်တာပါ။
- **အဓိက အားသာချက်**: သင်က `tail -f` နဲ့ log ကို စောင့်ကြည့်နေရင် ဖိုင်ကို Delete လုပ်လိုက်ရင် monitoring ပြတ်သွားပါလိမ့်မယ်။ `truncate` သုံးရင်တော့ monitoring မပြတ်ဘဲ စာမျက်နှာအသစ်ကနေ ပြန်စသလို ဖြစ်သွားစေပါတယ်။

---

### ၂။ tmux မှာ အဆင့်ဆင့် စမ်းသပ်ပုံ (Testing Workflow)

အခု သင်ရေးထားတဲ့ **Rule 1 (curl)** နဲ့ **Rule 3 (SMB)** ကို `tmux` ထဲမှာ ဒီလို စမ်းသပ်ကြည့်ရအောင်-

#### **အဆင့် (၁) - Log ကို ရှင်းထုတ်ပါ (Clean Slate)**

Command ပေးရမယ့် Pane ထဲမှာ ဒါကို အရင်ရိုက်ပါ-

```bash
sudo truncate -s 0 /var/log/suricata/fast.log
```

_(ဒါဆိုရင် `tail -f` ကြည့်နေတဲ့ pane မှာ စာတွေ အကုန်ပျောက်သွားပြီး ရှင်းလင်းသွားပါလိမ့်မယ်)_

#### **အဆင့် (၂) - Rule 1 (curl) ကို စမ်းသပ်ခြင်း**

နောက်ထပ် Pane တစ်ခုမှာ Python server ဖွင့်ထားပြီး အခုလို Request ပို့ကြည့်ပါ-

```bash
curl http://localhost/ -A "curl"
```

- **ဘာဖြစ်လာမလဲ**: `fast.log` ထဲမှာ `SUSPICIOUS - Non-Browser HTTP Client Detected` ဆိုတဲ့ alert တက်လာပါလိမ့်မယ်။

#### **အဆင့် (၃) - ပြန်ရှင်းပြီး နောက်ထပ် Rule တစ်ခု စမ်းခြင်း**

အဟောင်းကြီးနဲ့ မရောသွားအောင် `truncate` command ကို ထပ်သုံးပါ-

```bash
sudo truncate -s 0 /var/log/suricata/fast.log
```

#### **အဆင့် (၄) - Rule 3 (SMB Port 445) ကို စမ်းသပ်ခြင်း**

Port 445 ကို ဆက်သွယ်ဖို့ ကြိုးစားကြည့်ပါ (Nmap ရှိရင် Nmap သုံးလို့ရသလို၊ `telnet` လည်း သုံးနိုင်ပါတယ်)-

```bash
telnet localhost 445
```

- **ဘာဖြစ်လာမလဲ**: `fast.log` ထဲမှာ `CRITICAL - SMB Port Access Detected` ဆိုတဲ့ alert တက်လာပါလိမ့်မယ်။

---

### ၃။ အကျဉ်းချုပ် အသုံးဝင်ပုံ

| အဆင့်       | Command                              | ရည်ရွယ်ချက်                                             |
| ----------- | ------------------------------------ | ------------------------------------------------------- |
| **Clear**   | `sudo truncate -s 0 ...`             | Log အဟောင်းတွေကို ဖျက်ပြီး အသစ်ပြန်စရန်                 |
| **Attack**  | `curl` သို့မဟုတ် `telnet`            | Rule ကို Trigger ဖြစ်အောင် (တိုက်ခိုက်မှုပုံစံ) လုပ်ရန် |
| **Monitor** | `tail -f /var/log/suricata/fast.log` | Alert တက်လာတာကို Real-time ကြည့်ရန်                     |

ဒီနည်းလမ်းကို သုံးခြင်းအားဖြင့် သင့်ရဲ့ **Cyber Defense Mastery Lab** မှာ ဘယ် rule က ဘယ်အချိန်မှာ အလုပ်လုပ်သွားသလဲဆိုတာကို ရှုပ်ထွေးမှုမရှိဘဲ တိတိကျကျ စောင့်ကြည့်နိုင်မှာ ဖြစ်ပါတယ်။

## Using Nmap

```bash
sudo nmap -sS 192.168.56.103 (window)
```

ဒါကတော့ တကယ့်လက်တွေ့ **Lateral Movement** နဲ့ **Network Reconnaissance (ကွန်ရက်အတွင်း ထောက်လှမ်းခြင်း)** ကို စမ်းသပ်တာဖြစ်ပါတယ်။ `nmap -sS` command ဟာ **TCP SYN Scan (Stealth Scan)** လို့ခေါ်ပြီး Suricata က ဒါကို ဘယ်လိုမြင်သလဲဆိုတာ ရှင်းပြပေးပါ့မယ်။

---

### ၁။ `nmap -sS` က ဘာလုပ်တာလဲ?

`nmap -sS` ဟာ Target (သင့် Windows စက်) ဆီကို TCP Connection အပြည့်အဝမလုပ်ဘဲ "တံခါးခေါက်ပြီး ပြန်ပြေး" တဲ့ နည်းလမ်းနဲ့ Port တွေ ပွင့်/မပွင့် စစ်တာပါ။

- Rule 2 (`flags:S`) က ဒီလို SYN packet တွေကို စောင့်ကြည့်နေတာဖြစ်လို့ ဒီ Scan ဟာ Suricata ရဲ့ Alert ကို တန်းပြီး Trigger ဖြစ်စေပါတယ်။

---

### ၂။ ပေါ်လာမည့် Alert များကို ရှင်းလင်းချက်

သင့်ရဲ့ `fast.log` ထဲမှာ အောက်ပါအတိုင်း Alert တွေ တက်လာပါလိမ့်မယ် (ဥပမာအနေနဲ့ ဖော်ပြပေးထားပါတယ်)-

#### **(က) Lateral Movement Alert (Rule 2 အရ)**

```text
[**] [1:1000002:2] LATERAL MOVEMENT - Internal Host Scanning [**]
[Classification: Attempted Information Leak] [Priority: 2]
{TCP} 192.168.56.x (Ubuntu) -> 192.168.56.103 (Windows)
```

- **ဘာကြောင့်ပေါ်တာလဲ:** သင့်ရဲ့ Ubuntu ကနေ Windows ဆီကို Port ပေါင်းများစွာ (count 50 ကျော်) ကို ခဏလေးအတွင်း (seconds 30 အတွင်း) ဆက်သွယ်ဖို့ ကြိုးစားလို့ ဖြစ်ပါတယ်။
- **Real-world Meaning:** ဒါဟာ ဟက်ကာတစ်ယောက်က ကွန်ရက်ထဲ ရောက်နေပြီး တခြား ဘယ်စက်တွေမှာ အပေါက်အလမ်းရှိမလဲဆိုတာ လိုက်စစ်နေတာ (Scanning) ကို ဖမ်းမိတာပါ။

#### **(ခ) SMB Port Access Alert (Rule 3 အရ)**

အကယ်၍ Nmap က Port 445 ကို စစ်မိတဲ့အခါ-

```text
[**] [1:1000003:2] CRITICAL - SMB Port Access Detected [**]
[Priority: 1] {TCP} 192.168.56.x -> 192.168.56.103:445
```

- **ဘာကြောင့်ပေါ်တာလဲ:** Windows စက်တွေမှာ Port 445 (SMB) ဟာ ပုံမှန်ပွင့်နေတတ်ပြီး Nmap က အဲဒီ Port ကို သွားထိလိုက်တာနဲ့ ဒီ Rule က Trigger ဖြစ်သွားတာပါ။
- **Real-world Meaning:** ဒါဟာ WannaCry လိုမျိုး Ransomware တွေ ကူးစက်ဖို့ ကြိုးစားတဲ့ ပုံစံမျိုး ဖြစ်နေလို့ `CRITICAL` အဆင့်နဲ့ သတိပေးတာပါ။

---

### ၃။ Alert ထဲက အချက်အလက်များကို ဖတ်နည်း

Log ထဲမှာ ဒါတွေကို သတိထားကြည့်ပါ-

1. **SID (Signature ID):** `1000002` ဆိုရင် သင်ကိုယ်တိုင်ရေးထားတဲ့ Rule 2 ဖြစ်ကြောင်း သိနိုင်ပါတယ်။
2. **IP Addresses:** Ubuntu (Source) ကနေ Windows (Destination) ဆီကို သွားနေတာကို မြင်ရပါမယ်။
3. **Priority:** Priority 1 က ပိုအရေးကြီးပါတယ်။ (ဥပမာ - SMB access က Scanning ထက် ပိုအန္တရာယ်များတယ်လို့ သတ်မှတ်ထားတာပါ)။

---

### ၄။ ဘာကြောင့် Alert မတက်တာမျိုး ဖြစ်နိုင်သလဲ?

အကယ်၍ Nmap run ပေမယ့် Alert မတက်လာရင် ဒါတွေကို စစ်ဆေးပါ-

- **$HOME_NET:** `suricata.yaml` ထဲမှာ `192.168.56.0/24` ကို `HOME_NET` အဖြစ် သတ်မှတ်ထားရဲ့လား?
- **Interface:** Suricata က `192.168.56.x` network traffic တွေ ဖြတ်သန်းနေတဲ့ Network Card (ဥပမာ `eth1` သို့မဟုတ် `enp0s8`) ကို စောင့်ကြည့်နေရဲ့လား?
- **Threshold:** Rule 2 မှာ `count 50` လို့ ထားထားရင် Nmap က port ၅၀ ထက်နည်းပြီး scan လုပ်ရင် Alert တက်မှာ မဟုတ်ပါဘူး။

---

# Conclution

**"Suricata ကို ဘယ် Mode နဲ့ ပေးမောင်းထားသလဲ"** ဆိုတဲ့အပေါ်မှာ မူတည်ပါတယ်ခင်ဗျ။

Suricata မှာ အလုပ်လုပ်တဲ့ ပုံစံ (၂) မျိုး ရှိပါတယ်-

---

### ၁။ IDS Mode (စောင့်ကြည့်ရုံသက်သက်) - ပုံမှန်အခြေအနေ

အခု စမ်းသပ်နေတဲ့ ပုံစံက **IDS (Intrusion Detection System)** ဖြစ်ဖို့ များပါတယ်။

- **သူလုပ်ဆောင်ပုံ:** Nmap scan ဖတ်တာကို မြင်မယ်၊ Log ထဲမှာ Alert ထုတ်ပေးမယ်။ ဒါပေမဲ့ traffic ကို **ဖြတ်မချပါဘူး (Drop မလုပ်ပါဘူး)**။
- **ရလဒ်:** Ubuntu ကနေ Nmap scan ဖတ်ရင် Windows ဆီကနေ အဖြေပြန်ရနေတုန်းပဲ ဖြစ်ပါလိမ့်မယ်။ ဒါကို "အချက်ပေးခေါင်းလောင်းတီးရုံပဲ တီးတာ" လို့ ဥပမာပေးလို့ ရပါတယ်။

### ၂။ IPS Mode (တိုက်ခိုက်မှုကို ဖြတ်ချခြင်း)

အကယ်၍ သင်က တိုက်ခိုက်မှုကို အလိုအလျောက် ဖြတ်ချစေချင်ရင် **IPS (Intrusion Prevention System)** အဖြစ် ပြောင်းလဲအသုံးပြုရပါမယ်။

- **သူလုပ်ဆောင်ပုံ:** Traffic တွေကို အရင်ဖမ်းယူ စစ်ဆေးတယ်၊ Rule နဲ့ ငြိတာနဲ့ အဲဒီ packet ကို ရှေ့ဆက်မသွားခိုင်းတော့ဘဲ **Drop (ဖြတ်ချ)** လိုက်ပါတယ်။
- **Rule ပြောင်းလဲရမည့်ပုံစံ:** Rule ရဲ့ အရှေ့ဆုံးက `alert` ဆိုတဲ့ စကားလုံးနေရာမှာ **`drop`** လို့ ပြောင်းရေးရပါမယ်။
- ဥပမာ- `drop tcp any any -> $HOME_NET 445 (...)`

---

### ၃။ အလိုအလျောက် ဖြတ်ချနိုင်ဖို့ ဘာတွေလိုအပ်သလဲ?

Suricata က အလိုအလျောက် ဖြတ်ချပေးနိုင်ဖို့ (IPS လုပ်ဖို့) အောက်ပါအချက် (၃) ချက် လိုအပ်ပါတယ်-

1. **Operation Mode:** Suricata ကို `AF_PACKET` သို့မဟုတ် `NFQUEUE` mode မှာ IPS အနေနဲ့ run ထားရပါမယ်။
2. **Rule Action:** Rule ထဲမှာ `alert` အစား `drop` လို့ သတ်မှတ်ထားရပါမယ်။
3. **Deployment:** Suricata က Network traffic တွေရဲ့ **အလယ် (In-line)** မှာ ရှိနေရပါမယ်။ (ဥပမာ- Router နဲ့ Switch ကြား သို့မဟုတ် Firewall အနေနဲ့)။

---

### ၄။ ဘာကြောင့် အားလုံးကို မဖြတ်ချခိုင်းတာလဲ?

အပြင်လောကမှာ Security Admins တွေက အရာအားလုံးကို ချက်ချင်း `drop` မလုပ်ခိုင်းရဲကြပါဘူး။ ဘာကြောင့်လဲဆိုတော့:

- **False Positives:** တစ်ခါတစ်ရံ ပုံမှန်ဝန်ထမ်းတစ်ယောက်က မသိဘဲ လုပ်မိတာမျိုးကိုပါ Suricata က တိုက်ခိုက်မှုလို့ မှားယွင်းသတ်မှတ်ပြီး ဖြတ်ချလိုက်ရင် အလုပ်တွေ ပျက်ကုန်နိုင်လို့ပါ။
- ဒါကြောင့် အစပိုင်းမှာ `alert` နဲ့ပဲ စောင့်ကြည့်ပြီး တကယ်အန္တရာယ်ရှိတာ သေချာမှသာ `drop` (IPS) အဖြစ် ပြောင်းလဲလေ့ရှိပါတယ်။

---

### အနှစ်ချုပ်

အခု သင်စမ်းသပ်နေတဲ့ `alert` rules တွေကတော့ **အလိုအလျောက် ဖြတ်ချမှာ မဟုတ်ပါဘူး**၊ **သတိပေး (Warning)** ပဲ လုပ်ပေးမှာ ဖြစ်ပါတယ်။
